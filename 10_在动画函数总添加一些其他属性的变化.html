<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		*{margin: 0;padding: 0}
		p{
			width: 100px;
			height: 100px;
			background-color: red;
			font-size: 30px;
			text-align: center;
			position: relative;
		}
	</style>
</head>
<body>
	<button>动起来</button>
	<p></p>
	<script type="text/javascript" src="fn.js"></script>
	<script type="text/javascript">
		var p = $("p")[0];
		var button = $("button")[0];
		button.onclick = function(){
			// varSpeedMove(p,500,10);
			var tt = {
				"width":500,
				"height":500,
				"opacity":0
			};
			animate(p,tt,10);
		}
		// 对于之前的动画函数进行优化
		function animate(ele,target,rate){
			rate = rate || 10;
			// 避免多次点击，开启多个计时器
			clearInterval(ele.t);
			// 调用函数，实现变速运动
			ele.t = setInterval(function(){
				/*
				跟之前的差别是在于，在interval回调函数中，不再是只修改一个属性，而是要修改多个属性，这多个属性是来自于函数调用时，传入的那个target的key中-->意味着就需要对target中的所有key对应的属性进行设置 --> 要借助 for...in 循环，将 key 挨个取出，挨个处理
				*/
				var isOver = true; 
				for(var attrName in target){
					var current = getAttr(ele,attrName);
					if(attrName == "opacity"){
						// 针对透明度，进度特殊处理
						var res = target[attrName]*100 - current*100;
					}else{
						current = parseInt(current);
						var res = target[attrName] - current;
					}
					var step = (target[attrName]>current)?Math.ceil(res / rate):Math.floor(res / rate);
					var dis;
					if(attrName == "opacity"){
						dis = current * 100 + step;
						dis = dis / 100;
						ele.style[attrName] = dis;
					}else{
						dis = current + step;
						ele.style[attrName] = dis + "px";
					}
					var cha = Math.abs(target[attrName] - dis);
					if(cha != 0){
						// 如果这个cha变量差值不为 0，表示动画还应该继续，不能停下来
						isOver = false;
					}
				}
				// 在循环外部，进行是否要停止计时器的判断
				if(isOver){
					clearInterval(ele.t);
					console.log("停止计时器...");
				}
			},20);
		}
		// 定义一个函数，用于获取指定的元素的指定属性
		function getAttr(ele,attrName){
			return window.getComputedStyle(ele)[attrName];
		}
	</script>
</body>
</html>