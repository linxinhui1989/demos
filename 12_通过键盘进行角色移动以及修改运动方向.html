<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		*{margin: 0;padding: 0;}
		body{text-align: center;}
		canvas{}
	</style>
</head>
<body>
	<canvas width="800" height="600"></canvas>
	<script type="text/javascript">
		var canvas = document.querySelector("canvas");
		// canvas类似于画布，要想在画布上进行绘制，还需要去根据画布找到对应的工具栏
		var ctx = canvas.getContext("2d");
		// 通过js代码，动态创建Image对象
		var img = new Image();
		// 有了Image对象后，需要设置对应的src属性
		img.src = "./images/GoP_1.png";
		// 绘制之前，一定要先确保图片已经设置好src了
		var wh = 32;
		var xCount = Math.ceil(canvas.width / wh);
		var yCount = Math.ceil(canvas.height / wh);
		var imgs = {
			"idle":["./images/hero/idle/1.png","./images/hero/idle/2.png","./images/hero/idle/3.png","./images/hero/idle/4.png"],
			"walkdown":["./images/hero/walkdown/1.png","./images/hero/walkdown/2.png","./images/hero/walkdown/3.png","./images/hero/walkdown/4.png"],
			"walkleft":["./images/hero/walkleft/1.png","./images/hero/walkleft/2.png","./images/hero/walkleft/3.png","./images/hero/walkleft/4.png"],
			"walkright":["./images/hero/walkright/1.png","./images/hero/walkright/2.png","./images/hero/walkright/3.png","./images/hero/walkright/4.png"],
			"walkup":["./images/hero/walkup/1.png","./images/hero/walkup/2.png","./images/hero/walkup/3.png","./images/hero/walkup/4.png"]
		};
		var state = "idle"; // 0 对应的就是 idle
		var index = 0;
		var heroX = 100;
		var heroY = 100;
		img.onload = function(){
			// 确定障碍物的位置
			var blockPos = [];
			for(var i=0;i<80;i++){
				var x = parseInt(Math.random()*xCount);
				var y = parseInt(Math.random()*yCount);
				blockPos.push({"x":x,"y":y});
			}
			// 确定装饰物的位置
			var decoratePos = [];
			for(var i=0;i<50;i++){
				var x = parseInt(Math.random()*xCount);
				var y = parseInt(Math.random()*yCount);
				decoratePos.push({"x":x,"y":y});
			}
			setInterval(function(){
				canvas.width = canvas.width;
				canvas.height = canvas.height;
				// ctx.drawImage(img,0,0,100,50);
				// ctx.drawImage(img,0,0,100,50,193,321,31,31);
				for(var x = 0;x<xCount;x++){
					for(var y=0;y<yCount;y++){
						ctx.drawImage(img,224,288,wh,wh,wh*x,wh*y,wh,wh);
					}
				}
				// // 随机点缀页面
				for(var i=0;i<blockPos.length;i++){
					var x = blockPos[i].x;
					var y = blockPos[i].y;
					ctx.drawImage(img,192,320,wh,wh,wh*x,wh*y,wh,wh);
				}
				for(var i=0;i<decoratePos.length;i++){
					var x = decoratePos[i].x;
					var y = decoratePos[i].y;
					ctx.drawImage(img,224,320,wh,wh,wh*x,wh*y,wh,wh);
				}
				var img1 = new Image();
				var imgSrcs = imgs[state];
				img1.src = imgSrcs[index];
				img1.onload = function(){
					// 在canvas中，进行canvas刷新操作，只需重新设置canvas的高度以及宽度属性，就算值相同也会刷新
					ctx.drawImage(img1,0,0,16,16,heroX,heroY,wh,wh);
					index++;
					index %= imgSrcs.length;
				}
			},200);
		}
		// 对于键盘事件的注册
		document.addEventListener("keyup",function(e){
			// 获取到键盘按下时对应的keycode，从而判断按下的是什么按键
			var keyCode = e.keyCode;
			console.log(keyCode);
			if(keyCode==39){ // 向右
				state = "walkright";
				heroX+=wh;
			}else if(keyCode==37){ // 向左
				state = "walkleft";
				heroX-=wh;
			}else if(keyCode==40){ // 向下
				state = "walkdown";
				heroY+=wh;
			}else if(keyCode==38){ // 向上
				state = "walkup";
				heroY-=wh;
			}
		})
	</script>
</body>
</html>